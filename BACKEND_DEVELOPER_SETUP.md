# Backend Developer Setup Guide - Al Mahra Opticals

## For the Backend Developer

Hi! This project uses **AWS Amplify Gen 2** for the backend. Follow these steps to set up your development environment.

---

## Prerequisites

1. **Node.js** (v18 or higher)
2. **AWS Account** (we'll use the same account)
3. **Git** installed

---

## Initial Setup (One-time)

### Step 1: Clone the Repository

```powershell
git clone https://github.com/Codesandmore/almahra-Ecommerce-Website.git
cd almahra-Ecommerce-Website
cd "Almahra Ecommerce"
```

### Step 2: Install Dependencies

```powershell
npm install
```

### Step 3: Install Amplify CLI

```powershell
npm install -g @aws-amplify/cli
```

### Step 4: Configure AWS Credentials

**Option A: Use Your Own AWS Account (Recommended for Development)**
```powershell
amplify configure
```
Follow the prompts to create your own IAM user.

**Option B: Use Shared AWS Account**
Ask the frontend developer for:
- AWS Access Key ID
- AWS Secret Access Key
- Region: `ap-southeast-1` (or your chosen region)

Then configure manually:
```powershell
aws configure
```

---

## Daily Development Workflow

### 1. Start the Amplify Sandbox

```powershell
npx ampx sandbox
```

This will:
- Create AWS resources in the cloud
- Watch for changes in `amplify/` folder
- Auto-deploy changes
- Generate `amplify_outputs.json` for frontend

**Keep this running while you develop!**

### 2. Backend Code Structure

All backend code is in the `amplify/` folder:

```
amplify/
â”œâ”€â”€ auth/
â”‚   â””â”€â”€ resource.ts          # Authentication configuration
â”œâ”€â”€ data/
â”‚   â””â”€â”€ resource.ts          # Database models (DynamoDB)
â”œâ”€â”€ storage/
â”‚   â””â”€â”€ resource.ts          # File storage (S3)
â”œâ”€â”€ functions/
â”‚   â””â”€â”€ send-email/
â”‚       â”œâ”€â”€ resource.ts      # Lambda function definition
â”‚       â””â”€â”€ handler.ts       # Lambda function code
â””â”€â”€ backend.ts               # Main backend configuration
```

### 3. Your Responsibilities

#### A. Authentication (`amplify/auth/resource.ts`)
- Configure user sign-up/sign-in
- Set up email verification
- Define user attributes (name, phone, etc.)

#### B. Database Models (`amplify/data/resource.ts`)
Create models for:
- **Products** (name, price, brand, category, images, stock)
- **Orders** (user, items, total, status, shipping address)
- **Users** (profile, addresses, preferences)
- **Appointments** (branch, date, time, status)
- **ContactQueries** (name, email, phone, message, status)

#### C. Business Logic (Lambda Functions)
Create functions for:
- **Email Service** (order confirmations, appointment reminders)
- **Payment Processing** (if needed)
- **Inventory Management**
- **Order Status Updates**

#### D. File Storage (`amplify/storage/resource.ts`)
- Product images
- User uploads (prescription files)

---

## Backend Development Examples

### Example 1: Data Model (See `AWS_SETUP_GUIDE_GEN2.md` for full code)

```typescript
// amplify/data/resource.ts
import { a, defineData } from '@aws-amplify/backend';

const schema = a.schema({
  Product: a.model({
    name: a.string().required(),
    price: a.float().required(),
    brand: a.string().required(),
    // ... more fields
  }).authorization((allow) => [allow.publicApiKey().to(['read'])]),
});

export const data = defineData({ schema });
```

### Example 2: Lambda Function

```typescript
// amplify/functions/send-email/handler.ts
import type { Handler } from 'aws-lambda';

export const handler: Handler = async (event) => {
  // Your email sending logic
};
```

---

## Testing Your Backend

### 1. Test Locally with Sandbox

The sandbox creates real AWS resources, so you can test immediately:

```powershell
# Sandbox is running in terminal 1

# In terminal 2, run frontend
npm run dev
```

### 2. View Backend Resources

- **AWS Console**: https://console.aws.amazon.com/
- **DynamoDB Tables**: https://console.aws.amazon.com/dynamodbv2/
- **Lambda Functions**: https://console.aws.amazon.com/lambda/
- **Cognito Users**: https://console.aws.amazon.com/cognito/

### 3. Monitor Logs

```powershell
npx ampx logs
```

---

## Deploying Changes

### Development Branch
When you push changes to `amplify/` folder, the sandbox auto-deploys.

### Production Deployment
When ready for production:

```powershell
npx ampx sandbox --once
```

Or use Amplify Console for CI/CD with the main branch.

---

## Communication with Frontend Developer

### What Frontend Needs from You:

1. **`amplify_outputs.json`** (auto-generated by sandbox)
   - Don't commit this file to Git
   - Frontend developer will generate their own when they run the sandbox

2. **API Documentation**
   - Document the data models you create
   - Explain any custom Lambda functions
   - Share GraphQL queries/mutations (if using GraphQL)

3. **Authentication Flow**
   - Let them know required user attributes
   - Explain sign-up/sign-in process

### What You Need from Frontend:

1. **Data Requirements**
   - What data do they need for each page?
   - What fields for user profiles?
   - What info for products/orders?

2. **API Endpoints**
   - What operations do they need? (CRUD on products, create orders, etc.)

---

## File Structure Overview

```
Almahra Ecommerce/
â”œâ”€â”€ src/                          # Frontend code (React)
â”‚   â”œâ”€â”€ pages/                    # Pages (Home, Products, etc.)
â”‚   â”œâ”€â”€ components/               # Reusable components
â”‚   â””â”€â”€ main.jsx                  # App entry (Amplify.configure here)
â”œâ”€â”€ amplify/                      # Backend code (YOUR WORK)
â”‚   â”œâ”€â”€ auth/                     # Authentication
â”‚   â”œâ”€â”€ data/                     # Database models
â”‚   â”œâ”€â”€ storage/                  # File storage
â”‚   â”œâ”€â”€ functions/                # Lambda functions
â”‚   â””â”€â”€ backend.ts                # Backend config
â”œâ”€â”€ amplify_outputs.json          # Auto-generated (don't commit)
â”œâ”€â”€ AWS_SETUP_GUIDE_GEN2.md       # Detailed guide
â””â”€â”€ package.json                  # Dependencies
```

---

## Important Notes

### âš ï¸ Do NOT commit these files:
- `amplify_outputs.json` (already in `.gitignore`)
- `.amplify/` folder
- Any AWS credentials

### âœ… DO commit these files:
- Everything in `amplify/` folder (your backend code)
- `package.json` (if you add dependencies)
- Documentation you create

---

## Getting Help

1. **Official Docs**: https://docs.amplify.aws/react/
2. **Full Setup Guide**: See `AWS_SETUP_GUIDE_GEN2.md` in the repo
3. **Data Modeling**: https://docs.amplify.aws/react/build-a-backend/data/
4. **Auth Guide**: https://docs.amplify.aws/react/build-a-backend/auth/
5. **Functions Guide**: https://docs.amplify.aws/react/build-a-backend/functions/

---

## Quick Start Checklist

- [ ] Clone repository
- [ ] Run `npm install`
- [ ] Install Amplify CLI (`npm install -g @aws-amplify/cli`)
- [ ] Configure AWS credentials (`amplify configure`)
- [ ] Start sandbox (`npx ampx sandbox`)
- [ ] Create auth configuration (`amplify/auth/resource.ts`)
- [ ] Create data models (`amplify/data/resource.ts`)
- [ ] Test with frontend (`npm run dev` in another terminal)
- [ ] Create Lambda functions as needed
- [ ] Document your work
- [ ] Push changes to Git

---

## Questions?

Contact the frontend developer or check the detailed guide in `AWS_SETUP_GUIDE_GEN2.md`.

Happy coding! ğŸš€
